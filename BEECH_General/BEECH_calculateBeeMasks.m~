function masterData = BEECH_calculateBeeMasks(masterData)
    % Input
    %   masterData - standard format for processBEECHTREEcolonyFolder
    %
    %
    % Output
    %   masterData - wtih appended metadata files for bee masks
    
    %%
    for i = 1:numel(masterData) %loop across colonies
        
        trackingData = masterData(i).trackingData
        dailyBackgrounds = masterData(i).dailyBackgrounds;
        %%
        for j = 1:numel(trackingData)
           %%
               vid = VideoReader([trackingData(j).folder '/' trackingData(j).name]);
           nframes = vid.NumberOfFrames;
           
           backInd = find([dailyBackgrounds.day] == trackingData(j).day);
           backImage = dailyBackgrounds(backInd).backImage;
           
            for zz = 1:nframes
               
                %%
                
                im = rgb2gray(read(vid,zz));
                imgf = imgaussfilt(im);
                
                imd = double(im) - double(backImage);
                
                imagesc(imd);
                %%
                imshow(imadjust(im));
                %%
                alphamask(imd < -5, [1 0 0], 0.5);
            end
            
        end
        
        masterData(i).trackingData = trackingData; %Write tracking data back into masterData object
    end